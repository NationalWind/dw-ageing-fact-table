{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.10.6", "generated_at": "2025-08-03T05:15:09.127890Z", "invocation_id": "9c474910-9439-42b6-b176-302fafc780f1", "invocation_started_at": "2025-08-03T05:15:04.930062Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-08-03T05:15:08.601268Z", "completed_at": "2025-08-03T05:15:08.637393Z"}, {"name": "execute", "started_at": "2025-08-03T05:15:08.639499Z", "completed_at": "2025-08-03T05:15:09.064362Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.47160983085632324, "adapter_response": {"_message": "SELECT 1045", "code": "SELECT", "rows_affected": 1045}, "message": "SELECT 1045", "failures": null, "unique_id": "model.ageing_pipeline.fact_ageing", "compiled": true, "compiled_code": "\n\nWITH union_docs AS (\n    -- Combine invoices\n    SELECT\n        i.id AS document_id,\n        i.centre_id,\n        i.class_id,\n        i.student_id,\n        i.invoice_date AS document_date,\n        'invoice' AS document_type,\n        i.total_amount\n    FROM accounting.invoices i\n\n    UNION ALL\n\n    -- Combine credit_notes\n    SELECT\n        c.id,\n        c.centre_id,\n        c.class_id,\n        c.student_id,\n        c.credit_note_date AS document_date,\n        'credit_note',\n        c.total_amount\n    FROM accounting.credit_notes c\n),\n\npayments_agg AS (\n    SELECT\n        document_id,\n        document_type,\n        SUM(amount_paid) AS amount_paid\n    FROM accounting.payments\n    GROUP BY document_id, document_type\n),\n\ndocs_with_balance AS (\n    SELECT\n        d.*,\n        COALESCE(p.amount_paid, 0) AS amount_paid,\n        d.total_amount - COALESCE(p.amount_paid, 0) AS outstanding_amount\n    FROM union_docs d\n    LEFT JOIN payments_agg p\n        ON d.document_id = p.document_id AND d.document_type = p.document_type\n    WHERE (d.total_amount - COALESCE(p.amount_paid, 0)) > 0\n),\n\nwith_days_bucket AS (\n    SELECT\n        *,\n        DATE '2025-07-07' AS as_at_date,\n        DATE '2025-07-07' - document_date AS days_outstanding\n    FROM docs_with_balance\n),\n\nbucketed AS (\n    SELECT\n        *,\n        CASE WHEN days_outstanding BETWEEN 0 AND 30 THEN outstanding_amount ELSE 0.00 END AS day_30,\n        CASE WHEN days_outstanding BETWEEN 31 AND 60 THEN outstanding_amount ELSE 0.00 END AS day_60,\n        CASE WHEN days_outstanding BETWEEN 61 AND 90 THEN outstanding_amount ELSE 0.00 END AS day_90,\n        CASE WHEN days_outstanding BETWEEN 91 AND 120 THEN outstanding_amount ELSE 0.00 END AS day_120,\n        CASE WHEN days_outstanding BETWEEN 121 AND 150 THEN outstanding_amount ELSE 0.00 END AS day_150,\n        CASE WHEN days_outstanding BETWEEN 151 AND 180 THEN outstanding_amount ELSE 0.00 END AS day_180,\n        CASE WHEN days_outstanding > 180 THEN outstanding_amount ELSE 0.00 END AS day_180_and_above\n    FROM with_days_bucket\n)\n\nSELECT\n    centre_id,\n    class_id,\n    document_id,\n    document_date,\n    student_id,\n    day_30,\n    day_60,\n    day_90,\n    day_120,\n    day_150,\n    day_180,\n    day_180_and_above,\n    document_type,\n    as_at_date\nFROM bucketed", "relation_name": "\"ageing\".\"public\".\"fact_ageing\"", "batch_results": null}], "elapsed_time": 1.0257561206817627, "args": {"log_format_file": "debug", "log_file_max_bytes": 10485760, "require_explicit_package_overrides_for_builtin_materializations": true, "print": true, "require_resource_names_without_spaces": true, "upload_to_artifacts_ingest_api": false, "skip_nodes_if_on_run_start_fails": false, "require_yaml_configuration_for_mf_time_spines": false, "static_parser": true, "validate_macro_args": false, "state_modified_compare_more_unrendered_values": false, "send_anonymous_usage_stats": true, "empty": false, "partial_parse": true, "log_level": "info", "use_colors": true, "write_json": true, "cache_selected_only": false, "favor_state": false, "show_all_deprecations": false, "require_generic_test_arguments_property": false, "state_modified_compare_vars": false, "introspect": true, "which": "run", "version_check": true, "strict_mode": false, "indirect_selection": "eager", "use_colors_file": true, "partial_parse_file_diff": true, "exclude": [], "profiles_dir": "/opt/airflow/dbt", "require_nested_cumulative_type_params": false, "log_level_file": "debug", "show_resource_report": false, "log_format": "default", "quiet": false, "log_path": "/opt/airflow/dbt/logs", "defer": false, "source_freshness_run_project_hooks": true, "use_fast_test_edges": false, "printer_width": 80, "macro_debugging": false, "require_all_warnings_handled_by_warn_error": false, "select": [], "populate_cache": true, "warn_error_options": {"error": [], "warn": [], "silence": []}, "invocation_command": "dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt", "vars": {}, "project_dir": "/opt/airflow/dbt", "require_batched_execution_for_custom_microbatch_strategy": false}}